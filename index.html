<!DOCTYPE html> <!-- Declares the document type and version of HTML -->
<html lang="en"> <!-- Starts the HTML document and sets the language to English -->
<head>
    <meta charset="UTF-8"> <!-- Sets the character encoding for the document -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ensures responsive design for mobile devices -->
    <title>Retirement Savings Calculator</title> <!-- Title of the webpage that appears in the browser tab -->
    <style>
        /* CSS styling for the webpage */
        body {
            font-family: Arial, sans-serif; /* Sets the font family */
            margin: 20px; /* Adds margin around the body */
        }

        .calculator, .result-page {
            max-width: 500px; /* Limits the maximum width of the calculator and result page */
            margin: 0 auto; /* Centers the content horizontally */
            display: none; /* Initially hides the calculator and result page */
        }

        .active {
            display: block; /* Displays the active section (calculator or result) */
        }

        label, input, .toggle-option {
            display: block; /* Makes labels and inputs block elements for stacking */
            margin: 10px 0; /* Adds vertical margin between elements */
        }

        input, select {
            padding: 10px; /* Adds padding inside input fields */
            width: 100%; /* Makes input fields full width */
        }

        button {
            padding: 10px 20px; /* Adds padding inside buttons */
            background-color: #40A7DD; /* Sets the button background color */
            color: white; /* Sets the button text color */
            border: none; /* Removes default border from buttons */
            border-radius: 5px; /* Rounds the corners of buttons */
            cursor: pointer; /* Changes cursor to pointer when hovering over button */
            font-size: 16px; /* Sets font size for button text */
        }

        button:hover {
            background-color: #007bff; /* Changes background color on hover */
        }

        .result {
            margin-top: 20px; /* Adds margin above the result section */
            font-size: 18px; /* Sets font size for result text */
        }

        canvas {
            margin-top: 20px; /* Adds margin above canvas elements for charts */
        }
        
        .table-container {
            display: flex; /* Enables flexbox layout for the table container */
            justify-content: center; /* Centers the table within the container */
            margin-top: 20px; /* Adds margin above the table container */
        }
        
        table {
            width: 100%; /* Sets the table width to 100% of its container */
            border-collapse: collapse; /* Removes space between table borders */
            margin-top: 20px; /* Adds margin above the table */
        }

        table, th, td {
            border: 1px solid #40A7DD; /* Adds border to table, header, and cells */
        }

        th, td {
            padding: 10px; /* Adds padding inside table header and cells */
            text-align: center; /* Centers text within table cells */
        }

        th {
            background-color: #40A7DD; /* Sets background color for table headers */
            color: white; /* Sets text color for table headers */
        }

        /* New CSS for button container */
        .button-container {
            display: flex;
            justify-content: space-between; /* Space buttons evenly */
            margin-bottom: 20px; /* Space below the buttons */
        }
        
    </style>
    <!-- Includes Chart.js library for creating charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Includes jsPDF library for generating PDF files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Input Form -->
    <div class="calculator active" id="calculator"> <!-- Calculator section is initially active -->
        <h1>Retirement Savings Calculator</h1> <!-- Main heading for the calculator -->

        <label for="current-age">Current Age</label> <!-- Label for current age input -->
        <input type="number" id="current-age" min="0" max="100"> <!-- Input for current age -->

        <label for="retirement-age">Desired Retirement Age</label> <!-- Label for retirement age input -->
        <input type="number" id="retirement-age" min="0" max="100"> <!-- Input for retirement age -->

        <!-- Registered Retirement Savings -->
        <label for="registered-savings">Total Value of Registered Retirement Savings (RRSP, Spousal RRSP, RIF, LIF, LIRA, etc.)</label> <!-- Label for registered savings input -->
        <input type="number" id="registered-savings" min="0"> <!-- Input for registered savings amount -->

        <label for="registered-contribution">Contributions</label> <!-- Label for registered contribution input -->
        <input type="number" id="registered-contribution" min="0"> <!-- Input for registered contribution amount -->

        <label for="registered-contribution-type">Registered Savings Contribution Frequency</label> <!-- Label for contribution type -->
        <select id="registered-contribution-type"> <!-- Dropdown for selecting contribution frequency -->
            <option value="monthly">Monthly</option> <!-- Monthly option -->
            <option value="annual">Annual</option> <!-- Annual option -->
        </select>

        <!-- TFSA Savings -->
        <label for="tfsa-savings">Total Value of Tax-Free Savings Accounts (TFSAs)</label> <!-- Label for TFSA savings input -->
        <input type="number" id="tfsa-savings" min="0"> <!-- Input for TFSA savings amount -->

        <label for="tfsa-contribution">Contributions</label> <!-- Label for TFSA contribution input -->
        <input type="number" id="tfsa-contribution" min="0"> <!-- Input for TFSA contribution amount -->

        <label for="tfsa-contribution-type">TFSA Contribution Frequency</label> <!-- Label for TFSA contribution type -->
        <select id="tfsa-contribution-type"> <!-- Dropdown for selecting contribution frequency -->
            <option value="monthly">Monthly</option> <!-- Monthly option -->
            <option value="annual">Annual</option> <!-- Annual option -->
        </select>

        <!-- Non-Registered Savings -->
        <label for="non-registered-savings">Total Value of Non-Registered Savings (Cash, Margin, Corporate, etc.)</label> <!-- Label for non-registered savings input -->
        <input type="number" id="non-registered-savings" min="0"> <!-- Input for non-registered savings amount -->

        <label for="non-registered-contribution">Contributions</label> <!-- Label for non-registered contribution input -->
        <input type="number" id="non-registered-contribution" min="0"> <!-- Input for non-registered contribution amount -->

        <label for="non-registered-contribution-type">Non-Registered Contribution Frequency</label> <!-- Label for non-registered contribution type -->
        <select id="non-registered-contribution-type"> <!-- Dropdown for selecting contribution frequency -->
            <option value="monthly">Monthly</option> <!-- Monthly option -->
            <option value="annual">Annual</option> <!-- Annual option -->
        </select>

        <!-- Rate of Return -->
        <label for="annual-rate">Expected Annual Rate of Return (%)</label> <!-- Label for expected rate of return input -->
        <input type="number" id="annual-rate" step="0.01" min="0"> <!-- Input for annual rate of return -->

        <button onclick="calculateAndShowResult()">Calculate</button> <!-- Button to trigger calculation -->
    </div>

    <!-- Result Page -->
<div class="result-page" id="resultPage"> <!-- Div for displaying the result page -->
    <h1>Your Estimated Retirement Savings</h1> <!-- Heading for the result page -->

    <!-- Move buttons to the top -->
    <div class="button-container"> <!-- Container for the "Back" and "Print" buttons -->
        <button onclick="goBack()">Back</button> <!-- Button to go back to the calculator page -->
        <button onclick="saveAsPDF()">Print</button> <!-- Button to generate a PDF of the results -->
    </div>

    <div class="result" id="result"></div> <!-- Div to display the result of the calculations -->
    <canvas id="growthChart" width="500" height="250"></canvas> <!-- Canvas for the growth chart -->
    <canvas id="cashFlowChart" width="500" height="250"></canvas> <!-- Canvas for the cash flow chart -->
    <div class="table-container"> <!-- Container to hold the growth table -->
        <table id="growthTable"> <!-- Table to display the growth data -->
            <thead>
                <tr>
                    <th>Year</th> <!-- Table header for year -->
                    <th>Age</th> <!-- Table header for age -->
                    <th>Registered Starting Value</th> <!-- Table header for registered savings starting value -->
                    <th>Registered Contribution</th> <!-- Table header for registered savings contribution -->
                    <th>Registered Savings</th> <!-- Table header for registered savings value -->
                    <th>TFSA Starting Value</th> <!-- Table header for TFSA starting value -->
                    <th>TFSA Contribution</th> <!-- Table header for TFSA contribution -->
                    <th>TFSA Value</th> <!-- Table header for TFSA value -->
                    <th>Non-Registered Starting Value</th> <!-- Table header for non-registered starting value -->
                    <th>Non-Registered Contribution</th> <!-- Table header for non-registered contribution -->
                    <th>Non-Registered Value</th> <!-- Table header for non-registered value -->
                    <th>Total Investment Value</th> <!-- Table header for total investment value -->
                </tr>
            </thead>   
            <tbody>
                <!-- Data will be populated here -->
            </tbody>
        </table>
    </div>
</div>

   <script>
        let growthChart, cashFlowChart; // Declare variables for chart instances to hold the charts

        function calculateAndShowResult() {
    // Retrieve user input values from the form
    const currentAge = parseInt(document.getElementById('current-age').value); // Get current age
    const retirementAge = parseInt(document.getElementById('retirement-age').value); // Get retirement age
    const registeredSavings = parseFloat(document.getElementById('registered-savings').value) || 0; // Get registered savings or default to 0
    const registeredContribution = parseFloat(document.getElementById('registered-contribution').value) || 0; // Get registered contributions or default to 0
    const tfsaSavings = parseFloat(document.getElementById('tfsa-savings').value) || 0; // Get TFSA savings or default to 0
    const tfsaContribution = parseFloat(document.getElementById('tfsa-contribution').value) || 0; // Get TFSA contributions or default to 0
    const nonRegisteredSavings = parseFloat(document.getElementById('non-registered-savings').value) || 0; // Get non-registered savings or default to 0
    const nonRegisteredContribution = parseFloat(document.getElementById('non-registered-contribution').value) || 0; // Get non-registered contributions or default to 0
    const annualRate = parseFloat(document.getElementById('annual-rate').value) / 100; // Get the annual interest rate and convert it to a percentage
    const registeredContributionType = document.getElementById('registered-contribution-type').value; // Get contribution type for registered savings
    const tfsaContributionType = document.getElementById('tfsa-contribution-type').value; // Get contribution type for TFSA
    const nonRegisteredContributionType = document.getElementById('non-registered-contribution-type').value; // Get contribution type for non-registered savings

    // Validate input values
    if (isNaN(currentAge) || isNaN(retirementAge) || isNaN(annualRate) || currentAge >= retirementAge) {
        alert('Please enter valid values.'); // Show an alert if the inputs are invalid
        return; // Exit the function if invalid
    }

    // Adjust contributions based on selected frequency (monthly or annually)
    const adjustedRegisteredContribution = (registeredContributionType === 'monthly') ? registeredContribution * 12 : registeredContribution;
    const adjustedTFSAContribution = (tfsaContributionType === 'monthly') ? tfsaContribution * 12 : tfsaContribution;
    const adjustedNonRegisteredContribution = (nonRegisteredContributionType === 'monthly') ? nonRegisteredContribution * 12 : nonRegisteredContribution;

    const yearsToRetirement = retirementAge - currentAge; // Calculate the number of years until retirement

    // Initialize data storage for chart and table
    const chartData = {
        registered: [], // Array for registered savings data
        tfsa: [], // Array for TFSA data
        nonRegistered: [] // Array for non-registered savings data
    };
    const tableData = []; // Array for table data
    let futureValueRegistered = registeredSavings; // Future value of registered savings
    let futureValueTFSA = tfsaSavings; // Future value of TFSA
    let futureValueNonRegistered = nonRegisteredSavings; // Future value of non-registered savings

    // Loop through each year from current age to retirement age
    for (let i = 0; i <= yearsToRetirement; i++) {
        const registeredContribution = adjustedRegisteredContribution; // Get registered contribution for the year
        const tfsaContribution = adjustedTFSAContribution; // Get TFSA contribution for the year
        const nonRegisteredContribution = adjustedNonRegisteredContribution; // Get non-registered contribution for the year

        // Store savings values before contributions are added
        const registeredValueBeforeContribution = futureValueRegistered;
        const tfsaValueBeforeContribution = futureValueTFSA;
        const nonRegisteredValueBeforeContribution = futureValueNonRegistered;

        // Add contributions to the savings
        futureValueRegistered += registeredContribution;
        futureValueTFSA += tfsaContribution;
        futureValueNonRegistered += nonRegisteredContribution;

        // Add growth to the savings based on the annual rate
        futureValueRegistered += futureValueRegistered * annualRate;
        futureValueTFSA += futureValueTFSA * annualRate;
        futureValueNonRegistered += futureValueNonRegistered * annualRate;

        // Store the updated savings values in chartData
        chartData.registered.push(futureValueRegistered);
        chartData.tfsa.push(futureValueTFSA);
        chartData.nonRegistered.push(futureValueNonRegistered);

        // Prepare the data for the results table
        tableData.push({
            age: currentAge + i, // Age for the current row
            totalValue: futureValueRegistered + futureValueTFSA + futureValueNonRegistered, // Total savings value for the current row
            registeredValueBeforeContribution: registeredValueBeforeContribution, // Registered savings before contributions
            registeredValue: futureValueRegistered, // Registered savings after growth
            registeredContribution: registeredContribution, // Registered contribution amount
            tfsaValueBeforeContribution: tfsaValueBeforeContribution, // TFSA before contributions
            tfsaValue: futureValueTFSA, // TFSA after growth
            tfsaContribution: tfsaContribution, // TFSA contribution amount
            nonRegisteredValueBeforeContribution: nonRegisteredValueBeforeContribution, // Non-registered savings before contributions
            nonRegisteredValue: futureValueNonRegistered, // Non-registered savings after growth
            nonRegisteredContribution: nonRegisteredContribution // Non-registered contribution amount
        });
    }

    const totalFutureValue = futureValueRegistered + futureValueTFSA + futureValueNonRegistered; // Calculate the total savings at retirement
    document.getElementById('result').innerHTML = `Your estimated savings at retirement: $${totalFutureValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`; // Display the total savings result

    document.getElementById('growthChart').width = 1000; 
    document.getElementById('growthChart').height = 500;
    createGrowthChart(chartData, currentAge, retirementAge); // Call function to generate growth chart
    createGrowthTable(tableData); // Call function to populate the growth table
    createCashFlowChart(totalFutureValue, retirementAge); // Call function to generate cash flow chart

    // Switch from calculator to result page
    document.getElementById('calculator').classList.remove('active'); // Hide the calculator page
    document.getElementById('resultPage').classList.add('active'); // Show the result page

    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to the top of the page
}

        function createGrowthChart(chartData, currentAge, retirementAge) {
            const labels = []; // Array to hold age labels for the chart
            const currentYear = new Date().getFullYear(); // Get the current year

            // Create labels for each age from current to retirement
            for (let i = currentAge; i <= retirementAge; i++) {
                const year = currentYear + (i - currentAge); // Calculate year for the label
                labels.push(`${i} (${year})`); // Add label in format "age (year)"
            }

            const ctx = document.getElementById('growthChart').getContext('2d'); // Get 2D context for chart
            if (growthChart) {
                growthChart.destroy(); // Destroy previous chart instance if it exists
            }
            
            // Create a new bar chart
            growthChart = new Chart(ctx, {
                type: 'bar', // Chart type
                data: {
                    labels: labels, // Use age labels for the x-axis
                    datasets: [
                        {
                            label: 'Registered Retirement Savings', // Dataset label
                            data: chartData.registered, // Data for registered savings
                            backgroundColor: '#126090', // Bar color for registered savings
                            stack: 'combined', // Stack this dataset
                        },
                        {
                            label: 'TFSAs', // Dataset label
                            data: chartData.tfsa, // Data for TFSA
                            backgroundColor: '#40A7DD', // Bar color for TFSA
                            stack: 'combined', // Stack this dataset
                        },
                        {
                            label: 'Non-Registered Savings', // Dataset label
                            data: chartData.nonRegistered, // Data for non-registered savings
                            backgroundColor: '#83D3F6', // Bar color for non-registered savings
                            stack: 'combined', // Stack this dataset
                        }
                    ]
                },
                options: {
                    scales: {
                        x: { stacked: true }, // Stack the x-axis data
                        y: { stacked: true } // Stack the y-axis data
                    }

                }
            });
        }

        function createGrowthTable(tableData) {
    const tableBody = document.getElementById('growthTable').getElementsByTagName('tbody')[0]; // Get table body element
    tableBody.innerHTML = ''; // Clear any previous data in the table

    const currentYear = new Date().getFullYear(); // Get the current year

    tableData.forEach((row, index) => {
        const year = currentYear + index; // Increment the year for each row

        // Create a new table row
        const tr = document.createElement('tr');

        tr.innerHTML = `
            <td>${year}</td> <!-- Year column -->
            <td>${row.age}</td> <!-- Age column -->

            <!-- Registered savings columns -->
            <td>$${row.registeredValueBeforeContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Registered value before contribution -->
            <td>$${row.registeredContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Registered contribution column -->
            <td>$${row.registeredValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Registered savings after growth column -->

            <!-- TFSA columns -->
            <td>$${row.tfsaValueBeforeContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- TFSA value before contribution -->
            <td>$${row.tfsaContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- TFSA contribution column -->
            <td>$${row.tfsaValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- TFSA value after growth column -->

            <!-- Non-registered savings columns -->
            <td>$${row.nonRegisteredValueBeforeContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Non-registered value before contribution -->
            <td>$${row.nonRegisteredContribution.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Non-registered contribution column -->
            <td>$${row.nonRegisteredValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td> <!-- Non-registered savings value after growth column -->

            <!-- Total Investment Value column -->
            <td style="font-weight: bold;">$${row.totalValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</td>
        `;

        tableBody.appendChild(tr); // Append the row to the table body
    });
}

        function createCashFlowChart(totalValue, yearsToRetirement, annualRate) {
    const currentAge = parseInt(document.getElementById('current-age').value); // Get current age from input
    const retirementAge = parseInt(document.getElementById('retirement-age').value); // Get retirement age from input
    
    const cashFlowData = []; // Array to hold cash flow data
    
    // Calculate years after retirement
    const yearsAfterRetirement = 100 - retirementAge; // Assume lifespan of 100 for withdrawal calculation
    
    console.log('Current Age:', currentAge); // Log current age for debugging
    console.log('Retirement Age:', retirementAge); // Log retirement age for debugging
    console.log('Years After Retirement:', yearsAfterRetirement); // Log years after retirement for debugging
    console.log('Total Value:', totalValue); // Log total value for debugging
    console.log('Annual Growth Rate (from calculateAndShowResult):', annualRate); // Log annual growth rate for debugging

    // Step 1: Calculate the total discount factor based on growth rate
    let totalDiscountFactor = 0;
    for (let t = 1; t <= yearsAfterRetirement; t++) {
        totalDiscountFactor += 1 / Math.pow(1 + annualRate, t); // Use annualRate as the growth rate
    }

    console.log('Total Discount Factor:', totalDiscountFactor); // Log total discount factor for debugging

    // Step 2: Calculate annual withdrawal amount using the total discount factor
    let annualWithdrawal = 0;
    if (yearsAfterRetirement > 0 && totalValue > 0) {
        annualWithdrawal = totalValue / totalDiscountFactor; // Calculate annual withdrawal
    }

    console.log('Annual Withdrawal:', annualWithdrawal); // Log annual withdrawal for debugging

    // Step 3: Populate cash flow data array, considering growth and withdrawals
    let remainingBalance = totalValue; // Initialize remaining balance at retirement
    let currentYear = currentAge;
    
    for (let i = 0; i <= 100 - currentAge; i++) {
        if (currentYear < retirementAge) {
            // Before retirement, no cash flow
            cashFlowData.push(0);
        } else {
            // After retirement, withdraw and apply growth
            cashFlowData.push(annualWithdrawal); // Cash flow for this year
            
            // Log for each year
            console.log(`Year ${currentYear}, Withdrawal: ${annualWithdrawal}, Remaining Balance: ${remainingBalance}`);

            // Reduce remaining balance by withdrawal
            remainingBalance -= annualWithdrawal;
            
            // Apply growth to the remaining balance
            remainingBalance *= (1 + annualRate);
        }
        currentYear++; // Move to the next year
    }

    console.log('Cash Flow Data:', cashFlowData); // Log cash flow data for debugging

    // Step 4: Ensure the chart canvas element is correctly selected and rendered
    const ctx = document.getElementById('cashFlowChart').getContext('2d'); // Get 2D context for cash flow chart

    if (cashFlowChart) cashFlowChart.destroy(); // Destroy previous chart instance if it exists

    // Step 5: Create the chart
    cashFlowChart = new Chart(ctx, {
        type: 'bar', // Chart type
        data: {
            labels: Array.from({ length: cashFlowData.length }, (_, i) => `Age ${i + currentAge}`), // Create age labels
            datasets: [{
                label: 'Annual Pre-tax Cash Flow', // Dataset label
                data: cashFlowData, // Data for cash flow
                backgroundColor: '#40A7DD', // Bar color for cash flow
            }]
        },
        options: {
            responsive: true, // Responsive chart
            scales: {
                y: {
                    beginAtZero: true, // Start y-axis at zero
                    title: {
                        display: true, // Display y-axis title
                        text: 'Annual Pre-tax Cash Flow ($)', // Title text
                    },
                }
            }
        }
    });
}

        function goBack() {
            document.getElementById('resultPage').classList.remove('active'); // Hide result page
            document.getElementById('calculator').classList.add('active'); // Show calculator
        }

        function saveAsPDF() {
    const { jsPDF } = window.jspdf; // Import jsPDF library
    const doc = new jsPDF('l', 'pt', 'a4'); // Create a new PDF document with portrait orientation, points, A4 size

    // Retrieve input values again to ensure they are available
    const currentAge = parseInt(document.getElementById('current-age').value);
    const retirementAge = parseInt(document.getElementById('retirement-age').value);
    const registeredSavings = parseFloat(document.getElementById('registered-savings').value) || 0;
    const registeredContribution = parseFloat(document.getElementById('registered-contribution').value) || 0;
    const tfsaSavings = parseFloat(document.getElementById('tfsa-savings').value) || 0;
    const tfsaContribution = parseFloat(document.getElementById('tfsa-contribution').value) || 0;
    const nonRegisteredSavings = parseFloat(document.getElementById('non-registered-savings').value) || 0;
    const nonRegisteredContribution = parseFloat(document.getElementById('non-registered-contribution').value) || 0;
    const annualRate = parseFloat(document.getElementById('annual-rate').value) / 100;
    const registeredContributionType = document.getElementById('registered-contribution-type').value;
    const tfsaContributionType = document.getElementById('tfsa-contribution-type').value;
    const nonRegisteredContributionType = document.getElementById('non-registered-contribution-type').value;

    // Add title to PDF
    doc.setFontSize(18);
    doc.text('Retirement Savings Summary', 20, 30);

    // Add the savings summary to PDF
    const savingsSummary = document.getElementById('result').textContent;
    doc.setFontSize(12);
    doc.text(savingsSummary, 20, 60);

    doc.setFontSize(12); // Set font size
    // Add Assumptions section
    doc.text("Assumptions:", 20, 80); // Adjusted y-position for Assumptions
    doc.setFontSize(10); // Set font size
    doc.text(`Current Age: ${currentAge}`, 20, 100);
    doc.text(`Desired Retirement Age: ${retirementAge}`, 20, 120);
    doc.text(`Value of Registered Savings: $${registeredSavings.toFixed(2)}`, 20, 140);
    doc.text(`Registered Contributions: $${registeredContribution.toFixed(2)}, ${registeredContributionType}`, 20, 160);
    doc.text(`Value of TFSA: $${tfsaSavings.toFixed(2)}`, 20, 180);
    doc.text(`TFSA Contributions: $${tfsaContribution.toFixed(2)}, ${tfsaContributionType}`, 20, 200);
    doc.text(`Value of Non-registered: $${nonRegisteredSavings.toFixed(2)}`, 20, 220);
    doc.text(`Non-registered Contributions: $${nonRegisteredContribution.toFixed(2)}, ${nonRegisteredContributionType}`, 20, 240);
    doc.text(`Expected Rate of Return: ${annualRate * 100}%`, 20, 260);        

    // Add growth chart to PDF
    const growthChartCanvas = document.getElementById('growthChart');
    const growthChartImage = growthChartCanvas.toDataURL('image/png'); // Convert chart to image
    doc.addImage(growthChartImage, 'PNG', 20, 80, 500, 300); // Adjust width and height as needed

    // Add space between charts
    let yPosition = 490;

    // Add cash flow chart to PDF
    const cashFlowChartCanvas = document.getElementById('cashFlowChart');
    const cashFlowChartImage = cashFlowChartCanvas.toDataURL('image/png'); // Convert chart to image
    doc.addImage(cashFlowChartImage, 'PNG', 20, yPosition, 500, 300); // Adjust width and height as needed
    yPosition += 280; // Adjust y position for the next section

    // Add growth table to PDF using autoTable
    doc.setFontSize(14);
    doc.text('Growth Table:', 20, yPosition);

    yPosition += 20; // Adjust y position for table

    // Prepare the table headers and rows from the growth table
    const tableBody = document.getElementById('growthTable').getElementsByTagName('tbody')[0]; // Get table body element
    const rows = tableBody.getElementsByTagName('tr'); // Get all rows from the table

    // Extract headers from the table
    const tableHeader = [];
    const headers = document.getElementById('growthTable').getElementsByTagName('thead')[0].getElementsByTagName('th');
    for (let i = 0; i < headers.length; i++) {
        tableHeader.push(headers[i].innerText);
    }

    // Extract rows data from the table
    const tableData = [];
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.getElementsByTagName('td');
        const rowData = [];
        for (let j = 0; j < cells.length; j++) {
            rowData.push(cells[j].innerText);
        }
        tableData.push(rowData); // Push each row to the table data array
    }

    // Use autoTable plugin to add the table to the PDF
    doc.autoTable({
        head: [tableHeader], // Table headers
        body: tableData, // Table rows
        startY: yPosition, // Start position of the table
        theme: 'grid', // Apply grid lines for table cells
        styles: {
            fontSize: 8,
            cellPadding: 4,
            overflow: 'linebreak',
        },
        headStyles: {
            fillColor: '#40A7DD', // Set header background color to match branding
        },
        columnStyles: {
            // Apply bold text for the last column (assuming it's the last in the data)
            [tableHeader.length - 1]: { fontStyle: 'bold' }, // Bold the last column (Total Investment Value)
        },
        
    });
    // Add disclaimer to the bottom of the PDF
    doc.setFontSize(7);
    doc.text('Disclaimer: The information and values presented in this document are for illustration purposes only and should not be considered financial advice. Actual investment results may vary. Please consult with a financial professional for specific advice tailored to your situation.', 20, doc.internal.pageSize.height - 30, {
        maxWidth: 550, // Ensures the text wraps within the page width
    });

    // Save the PDF with the specified name
    doc.save('retirement_savings_summary.pdf');
}

    </script>
</body>
</html>
